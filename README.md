<div align="center">
  <picture>
    <source media="(prefers-color-scheme: dark)" srcset="./docs/images/logo_kuva_space_white.png">
    <img alt="kuva-space-logo" src="./docs/images/logo_kuva_space_black.png" width="50%">
  </picture>
</div>

# Kuva Data Processing

[![kuva-geometry](https://img.shields.io/pypi/v/kuva-geometry.svg?label=kuva-geometry)](https://pypi.org/project/kuva-geometry/)
[![kuva-metadata](https://img.shields.io/pypi/v/kuva-metadata.svg?label=kuva-metadata)](https://pypi.org/project/kuva-metadata/)
[![kuva-reader](https://img.shields.io/pypi/v/kuva-reader.svg?label=kuva-reader)](https://pypi.org/project/kuva-reader/)

This project is aimed for externals to be able to read and process data products
generated by the Kuva Space Hyperfield satellites.

**Table of Contents**
- [Project contents](#project-contents)
- [Installation from Pypi](#installation-from-pypi)
- [Installation from source](#installation-from-source)
  - [Installing a virtual environment](#installing-a-virtual-environment)
  - [Installing the projects](#installing-the-projects)
- [Code](#code)
  - [Kuva reader - Minimal example](#kuva-reader---minimal-example)
  - [Kuva reader - Inspect product](#kuva-reader---inspect-product)
- [Contributing](#contributing)
- [Contact information](#contact-information)
- [License](#license)



### Status of unit tests

[![Unit tests for kuva-geometry](https://github.com/KuvaSpace/kuva-data-processing/actions/workflows/test-kuva-geometry.yml/badge.svg?branch=main)](https://github.com/KuvaSpace/kuva-data-processing/actions/workflows/test-kuva-geometry.yml?branch=main)
[![Unit tests for kuva-metadata](https://github.com/KuvaSpace/kuva-data-processing/actions/workflows/test-kuva-metadata.yml/badge.svg?branch=main)](https://github.com/KuvaSpace/kuva-data-processing/actions/workflows/test-kuva-metadata.yml?branch=main)
[![Unit tests for kuva-reader](https://github.com/KuvaSpace/kuva-data-processing/actions/workflows/test-kuva-reader.yml/badge.svg?branch=main)](https://github.com/KuvaSpace/kuva-data-processing/actions/workflows/test-kuva-reader.yml?branch=main)

## Project contents

The data reader consists of two sub-projects:

1. `kuva-metadata`, which contains metadata definitions of all the different parts and 
devices of the Kuva products
2. `kuva-reader`, which can be used to read data products produced by Hyperfield in a 
Pythonic way. Given a geotiff and its metadata sidecar file, a data product can be 
loaded and processed.
3. `kuva-geometry`, which contains some helper functionalities and class definitions for 
calculating geometric properties, such as camera ray intersections on the Earth.


# Installation

Installation is done simply through PyPi. You may install one of the sub-packages individually, but the `kuva-reader` package allows you to read Kuva Space data products, and it includes the two other sub-projects as dependencies.

```sh
pip install kuva-reader
```

The installation is recommended to be done in a Python virtual environment. If you do not have one, follow the instructions below to install it.

## Installing a virtual environment

To make installation smooth and sure to work, we recommend installing a virtual 
environment with a specific Python version, along with the Poetry program for handling Python package installing.

One example of a virtual environment manager is pyenv, which can be installed with

```bash
# Update local packages
sudo apt update -y
# Install Pyenv
curl https://pyenv.run | bash

# Then configure your bash script to recognize pyenv
echo 'export PATH="$HOME/.pyenv/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(pyenv init -)"' >> ~/.bashrc
echo 'eval "$(pyenv virtualenv-init -)"' >> ~/.bashrc
source ~/.bashrc
```

We recommend using Python version 3.12 for `kuva-datareader`, but it is tested in versions 3.10 - 3.13.

```bash
# Install the Python version
pyenv install 3.12
# Create a virtual environment with the given Python version
pyenv virtualenv 3.12 kuva-env
# Activate the virtual environment
pyenv activate kuva-env
```



# Code
### Kuva reader - Minimal example

This is a minimal example that allows you to read and print the image shape of a L1 product. \
The result product is in this case an L1C product (as seen from the folder name). 
The loaded product is stored in a `rioxarray` object, which contains extensive GIS functionalities [(examples for usage)](https://corteva.github.io/rioxarray/stable/examples/examples.html). 

```python
from pathlib import Path

from kuva_reader import Level1ABProduct

DATA_ROOT = Path("data")
product_path = DATA_ROOT / "hyperfield1a_L1B_20250105T092548/"

product = Level1ABProduct(product_path)
print(product.image.shape)
```

# Contributing

Please follow the guidelines in [CONTRIBUTING.md](CONTRIBUTING.md).

Also, please follow our [Code of Conduct](CODE_OF_CONDUCT.md) while discussing in the 
issues and pull requests.

# Contact information

For questions or support, please open an issue. If you have been given a support contact, 
feel free to send them an email explaining your issue.

# License

The `kuva-data-processing` repository software is under the [MIT license](LICENSE.md).

